<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <!-- BOOTSTRAP        -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <!-- JQuery           -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <!-- JS de Bootstrap  -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <!-- CSS -->
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/animate.css">
    <link rel="stylesheet" href="css/estilos.css">

    <script src="listas.js"></script>
    <script src="validar_extension.js"></script>
	<title>Agregar prologa</title>
</head>
<body>
	<div class="container" id="container">
        <div class="panel panel-primary borde-color"">

            <!--TITULO DE ALTAS DE OBRAS-->
            <div class="row">
                <div class="col-md-2" style="background-color: #2C5234; border-color: #2C5234;
                    color: #ffff; margin-top: 15px; text-align: center;">
                    <h4>Agregar Prologa</h4>
                </div>
            </div>
               
    
            
            <div class="row" style="margin-bottom: 15px;">
                <!--TITULO DE SIEObras-->
                <div class="logo" style="text-align: center;">
                    <img src="imagenes/10_uaem_movHNormal.png" alt="Imagen no encontrada" style="max-width: 200px;">
                </div>
                <div class="col-md-12" style="text-align: center;">
                    <br>
                    <h1>SIEObra</h1>
                    <h3>Sistema de Información Estadistica de Obra Universitaria</h3>
                </div>
                            
                <!--LINEA DE COLORES-->
                <div style="margin: 0px 180px;">
                    <div class="panel-heading col-md-4" style="background-color: #2C5234; border-color: #2C5234; margin-bottom: 35px; padding: 4px;" >
                    </div>
                    
                    <div class="panel-heading col-md-8" style="background-color: #9C8412;border-color: #9C8412; margin-bottom: 35px; padding: 4px;" >              
                    </div>  
                </div>
            </div>
            <div class="row">
                <div class="col-md-12" style="margin: 0px 35px;">
                    <a href="index.php"><img src="imagenes/regresar.png" alt="imagen">Regresar</a>
                </div>
            </div>
           

            <!--DESDE AQUI COMIENZA LA IMAGEN DE CARGANDO-->
            <div class="login" id="vtn_login" style="text-align: center; display: none">
                <img src="imagenes/cargando.gif" alt="Imagen no encontrada">
            </div>
            
            <!--DESDE AQUI COMIENZA LA IMAGEN DE BIEN OSEA QUE TODO TERMINO CON EXITO-->
            <div class="bien" id="vtn_bien" style="text-align: center; display: none">
                <img src="imagenes/bien-128.png" alt="Imagen no encontrada">
                <h5>Se actualizo con exito la informacion.</h5>
                <p><a href="Editar.html">Regresar</a></p>
            </div>

            <!--COMO DESEA REALIZAR LA BUSQUEDA-->
            <div class="panel-body animated bounceIn" id="panel-principal" style="display: block;">
                <!--COMO DESEA REALIZAR LA CONSULTA-->
                <div class="row" id="capa" style="display: block;  margin: 25px 0px;">
                    <div class="col-md-12" style="text-align: left; color: #1976d2">
                        <h2>Filtro de busqueda</h2>
                    </div>
                    <div class="col-md-12">
                        <select class="form-control form-control-lg" name="opc_buscar" id="opc_buscar">
                            <option value="0">Seleccionar una opción</option>
                            <option value="1">Nombre de la obra</option>
                            <option value="2">Numero de contrato</option>
                            <option value="3">Espacio beneficiado</option>
                        </select>
                    </div>
                </div>

                <!--NOMBRE DE LA OBRA-->
                <div class="row animated" id="capa1" style="display: none;margin:15px;">
                    <div class="col-md-12" style="color: #1976d2">
                        <h2>Nombre de la obra</h2>
                    </div>
                    <!--NOMBRE DE LA OBRA-->
                    <div class="col-md-8 form-group">
                            <div class="input-group">
                                <span class="input-group-addon">
                                    <span class="fa fa-building-o"></span>
                                </span>
                                <input type="text" class="form-control" id="nombreObra" name="nombreObra" placeholder="Ingresa el nombre de la obra" required="Campo obligatorio" maxlength="200">
                            </div>
                    </div>
                    
                    <div class="col-md-4" style="text-align: right;">
                        <button type="button" class="btn btn-link" onclick="mostrar_opc(1)">Regresar</button>
                    </div>
                </div>
                
                <!--NUMERO DE CONTRATO-->
                <div class="row animated" id="capa2" style="display: none;margin:15px;">
                    <div class="col-md-12" style="color: #1976d2">
                        <h2>Numero de contrato</h2>
                    </div>
                    <!--NUMERO DE CONTRATO-->
                    <div class="col-md-8 form-group">
                            <div class="input-group">
                                <span class="input-group-addon">
                                    <span class="fa fa-building-o"></span>
                                </span>
                                <input type="text" class="form-control" id="n_Contrato" name="n_Contrato" placeholder="Ingresa numero de contrato" required="Campo obligatorio" maxlength="200">
                            </div>
                    </div>
                    <div class="col-md-4" style="text-align: right;">
                        <button type="button" class="btn btn-link" onclick="mostrar_opc(2)">Regresar</button>
                    </div>
                </div>

                <!--ESPACIO BENEFICIADO-->
                <div class="row animated" id="capa3" style="display: none;margin:15px;">
                    <div class="col-md-12" style="color: #1976d2">
                        <h2>Espacio Beneficiado</h2>
                    </div>
                    <!--ESPACIO BENEFICIADO-->
                    <div class="col-md-8 form-group">
                            <div class="input-group">
                                <span class="input-group-addon">
                                    <span class="fa fa-building-o"></span>
                                </span>
                                <input type="text" class="form-control" id="espacio_B" name="espacio_B" placeholder="Ingrese nombre del espacio beneficiado" required="Campo obligatorio" maxlength="200">
                            </div>
                    </div>
                    
                    <div class="col-md-4" style="text-align: right;">
                        <button type="button" class="btn btn-link" onclick="mostrar_opc(3)">Regresar</button>
                    </div>
                </div>
            </div>

            <!--TABLA DE CONSULTA-->
            <div class="animated bounceIn" id="datos" style="margin:25px;">
                
            </div>
        </div>
    </div>
    <div><!-- DESDE AQUI COMIENZA LA VENTANA MODAL DE NUEVO ESPACIO ACADEMICO -->
        <div class="modal fade bd-example-modal-lg" id="VentanaModal3" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" >
          <div class="modal-dialog modal-lg" role="document" style="width: 1100px;">
            <div class="modal-content">
               <div class="alert alert-success animated" id="mnsjEspacioBeneficiado" style="display: none; text-align: center;">...</div>
              <div class="row modal-header" style="margin:0px;">
                <div class="col-sm-10 titulo">
                    <h4 class="modal-title animated bounceInLeft" id="modalTitle"></h4>
                </div>
                <div class="col-sm-2" style="text-align: right;">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                </div>
              </div>
              
              <div class="modal-body" id="modalBody" style="text-align: justify;">
                    <!--FECHA ORIGINAL DEL PROYECTO-->
                    <div class="row espacio">
                            <div class="col-md-12">
                                
                                   
                                    <div class="panel-body">
                                        <div class="row form-group">
                                            <h5>Fecha del proyecto</h5>
                                            <!--FECHA DE INICIO-->
                                            <div class="col-md-4 offset-md-1">
                                                <label for="inicio">Inicio</label>
                                                <div class="input-group">
                                                    <span class="input-group-addon">
                                            <span class="fa fa-calendar-plus-o"></span>
                                                    </span>
                                                    <input type="date" name="fechaInicio" id="fechaInicio" disabled>
                                                </div>
                                            </div>
                                            <!--FECHA DE TERMINO-->
                                            <div class="col-md-4 offset-md-1">
                                                <label for="fin">Termino</label>
                                                <div class="input-group">
                                                    <span class="input-group-addon">
                                            <span class="fa fa-calendar-check-o"></span>
                                                    </span>
                                                    <input type="date" name="fechaTermino" id="fechaTermino" disabled>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                
                            </div>
                    </div>
                    <!-- CONSULTAMOS SI EXISTE ALGUNA PROLOGA (TABLA DE PROLOGAS) -->
                    <div class="animated bounceIn" id="consultaPrologas" style="margin:25px;">   
                    </div>
                    <!--AGREGAR UNA NUEVA PROLOGA-->
                    <form id="miFormReportes" enctype="multipart/form-data" style="display: none">
                        <div class="row">
                        <div id="ocultar" style="margin: 15px 30px;" class="panel panel-primary">
                            <div class="panel-heading">
                                 <h4>Agregar una nueva prologa</h4>
                             </div>
                         <div class="panel-body" style="padding-bottom: 0px;">
                            <!-- FECHA Y CONTRATO -->
                             <div class="row" style="margin: 0px 3px;">
                                 <div class="col-md-6"> 
                                        <label for="fechaProloga" style="margin-left: 13px">Fecha de prologa</label>                                        
                                            <div class="input-group" style="margin: 12px;">
                                                    <span class="input-group-addon">
                                                        <span class="fa fa-calendar-check-o"></span>
                                                    </span>
                                                    <input type="date" name="fechaProloga" id="fechaProloga" required="obligatorio">
                                            </div>
                                            
                                        
                                 </div>
                                 <div class="col-md-6">    
                                        <label for="documento">Documento PDF</label> 
                                        <input type="file" id="estadoCuenta" name="estadoCuenta" style="padding: 15px 0px" required="obligatorio">
                                     
                                 </div>
                            </div>
                            
                             <br>
                              <!-- OBSERVACIONES -->
                             <div class="row" style="margin: 0px 3px;">
                                 <div class="col-md-12">
                                        <label for="observaciones">Observaciones (opcional)</label>
                                        <textarea name="observaciones" id="observaciones" style="width: 100%; resize: none;"></textarea>
                                     </div>
                             </div>
                             <br>
                             <div class="row" style="margin: 16px 0px">
                                <div class="col-md-4 col-md-offset-4">
                                    <button  type="submit"  id="submit" class="btn btn-primary" style="width: 100%">Enviar</button>
                                </div>
                             </div>

                             </div><!--Este es el div del panel-body -->
                             <br><input type="text" id="xId" style="display: none" name="id">
                             
                            </div>
                         </div>
                    </form>
                    
                    </div>
                    <!--IMAGEN DE CARGANDO-->
                    <div class="cargando" id="cargando" style="text-align: center; display: none">
                        <img src="imagenes/cargando.gif" alt="No se encontro la imagen">
                    </div>        
              </div><!--AQUI TERMINA modal-body -->
            </div><!--AQUI TERMINA modal-content -->
          </div><!--AQUI TERMINA modal-dialog -->
        </div><!--AQUI TERMINA modal fade -->
    </div><!--AQUI TERMINA LA VENTANA MODAL DE NUEVO ESPACIO ACADEMICO-->
</body>
 <script src="base-tbl-buscar.js"></script>
<script>
    var SId = null;
    $(document).ready(function()
    {
        consultar();
    });

    function llenar(id)
    {
        //SE DA CLICK EN LA TABLA Y SE SELECCIONA UNO EN ESPESIFICO  
        SId=id;
        buscarProloga(id);
        buscarObra(id);
        $("#VentanaModal3").modal();
    }

    function buscarProloga(id)
    {
        $.ajax({
            url: 'buscarProloga.php',
            type: 'POST',
            dataType: 'html',
            data: {id: id},
        })
        .done(function(respuesta) 
        {
            $("#consultaPrologas").html(respuesta);
        })
        .fail(function() 
        {
            console.log("error: buscarProloga");
        })
        .always(function() 
        {
            console.log("Se completo buscarProloga");
        });
        
    }

    function buscarObra(id)
    {
        $.ajax({
            url: 'buscarObra.php',
            type: 'POST',
            dataType: 'JSON',
            data: {id: id},
        })
        .done(function(datos) 
        {
            document.getElementById("modalTitle").innerHTML=datos.nombre;
            $("#fechaInicio").val(datos.FechaInicio);
            $("#fechaTermino").val(datos.FechaTermino);
        })
        .fail(function() 
        {
            console.log("error: buscarObra");
        })
        .always(function() 
        {
            console.log("complete");
        });
        
    }

     $("#miFormReportes").on("submit", function(e)//FUNCION AJAX PARA DAR DE ALTA UN NUEVO REPORTE
    {

        e.preventDefault();//evita que se recarge la pagina
        //insertamos el id de la obra al formulario para que se conosca en la otra pagina
        document.getElementById("xId").value=SId;
        $("#xId").css("display", "block");
        var formData = new FormData(document.getElementById("miFormReportes"));
        $("#xId").css("display", "none");
       
        
       $.ajax({
                    url:"altaPrologas.php",
                    type:"POST",
                    dataType:"json",
                    contentType: "application/x-www-form-urlencoded; charset=UTF-8",
                    data:formData,
                    cache:false,
                    contentType: false,
                    encode:true,
                    processData: false,
                    beforeSend: function()
                    {
                        
                        $("#ocultar").css("display", "none");
                        $("#cargando").css("display", "block");
                    },
                    success: function(datos)
                    {
                        console.log(datos.documento);
                        console.log(datos.tablaPrologas);

                        document.getElementById("miFormReportes").reset();

                        $("#ocultar").css("display", "block");
                        $("#cargando").css("display", "none");
                        buscarProloga(SId);
                                                   
                    },
                    error: function(XMLHttpRequest,data)
                    {
                        $("#miFormReportes").css("display", "block");
                        $("#cargando").css("display", "none");
                        console.log("Mal :( "+XMLHttpRequest.responseText+" data: "+data.documento);
                    } 
                });
        
    });
</script>